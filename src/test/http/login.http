### Keycloak Direct Access Token 요청
POST http://localhost:8089/realms/polio/protocol/openid-connect/token
Content-Type: application/x-www-form-urlencoded

grant_type=password&
client_id=polio-toy-client&
client_secret=I6uiQiYIegQVvvIsAgFUpexpgNjfR86H&
username=test&
password=test


> {%
    const res = response.body;
    client.global.set("user_access_token", res.access_token);
    client.global.set("user_refresh_token", res.refresh_token);
%}



### 로그아웃 - refresh_token 사용
POST http://localhost:8089/realms/polio/protocol/openid-connect/logout
Content-Type: application/x-www-form-urlencoded

client_id=polio-toy-client&
client_secret=I6uiQiYIegQVvvIsAgFUpexpgNjfR86H&
refresh_token={{user_refresh_token}}

> {%
    client.global.clear("user_access_token");
    client.global.clear("user_refresh_token");
%}


###
POST http://localhost:8080/auth/login
Content-Type: application/json

{
  "username": "polio-toy-client-user1",
  "password": "polio-toy-client-user1"
}

### 3. 사용자 비밀번호 변경
# 위에서 얻은 사용자 ID (userId)를 아래 URL에 넣어주세요
PUT http://localhost:8089/admin/realms/polio/users/5647cdfb-e870-4e7c-803b-47a581381558/reset-password
Content-Type: application/json
Authorization: Bearer {{client_access_token}}

{
  "type": "password",
  "value": "NEW_PASSWORD_HERE",
  "temporary": false
}


###
PUT http://localhost:8080/auth/password
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJVR3pubEo0NlNmLUhOTno0M1NYcHNPOTQ1aFQ3amxBSEdTTDhuRnVmamEwIn0.eyJleHAiOjE3NTEyODMzODUsImlhdCI6MTc1MTE5Njk4NSwianRpIjoiMWFlOTFlN2MtMGM3Yy00ZTlkLWJlYWItMDU1OWNmNThjZDBkIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDg5L3JlYWxtcy9wb2xpbyIsImF1ZCI6WyJhY2NvdW50IiwicG9saW8tdG95LWNsaWVudC1hY3Rpb24iXSwic3ViIjoiOWQ4MzNmYzUtY2MxZS00YjYwLThmNWUtMjdmZGIzYzNkYjcwIiwidHlwIjoiQmVhcmVyIiwiYXpwIjoicG9saW8tdG95LWNsaWVudCIsInNlc3Npb25fc3RhdGUiOiIxYjFjM2JhOS1kZGQ4LTQ4ZWQtYjdiNC1lMzhlYTRkODExMDgiLCJhY3IiOiIxIiwiYWxsb3dlZC1vcmlnaW5zIjpbIi8qIl0sInJlYWxtX2FjY2VzcyI6eyJyb2xlcyI6WyJhdXRoZW50aWNhdGVkIiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiIsImRlZmF1bHQtcm9sZXMtcG9saW8iXX0sInJlc291cmNlX2FjY2VzcyI6eyJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50IiwibWFuYWdlLWFjY291bnQtbGlua3MiLCJ2aWV3LXByb2ZpbGUiXX19LCJzY29wZSI6Im9mZmxpbmVfYWNjZXNzIGVtYWlsIHByb2ZpbGUiLCJzaWQiOiIxYjFjM2JhOS1kZGQ4LTQ4ZWQtYjdiNC1lMzhlYTRkODExMDgiLCJlbWFpbF92ZXJpZmllZCI6ZmFsc2UsInByZWZlcnJlZF91c2VybmFtZSI6InRlc3QiLCJlbWFpbCI6InR1dHVhdHV0dTFAZ21haWwuY29tIn0.bsVsEkqucX_WrQWavAX6eIqupcjsOwZzsjH04goGHtAdm0nbI2CralhKZMN-QBxPd6UXWARTKavd3p5r6UXf99QNYI-v2gQM0EooAVn6Ir3RCU-LfdYgW-Odn5qhes0E-m_vMI3ZcVXMuuNB0FrHhjsz_YlHQd0H2TDnRkpwI_7F2ZgSqZNyVX0yEdSdt_HQV3OAFB5s5mjU4byvBVtZRumBmrZGd9DilhEUS_ZGeIyW6USsOjLrj2cAD0I7YMwOwjGnhmZL8IDCwrN6-6_hvNAbQyQ5G-5EQ1ynK2tPmyYpWSxON4A7Aee2jJkcWXDOdebE9Z1PhahBisna_1zPuA

{"newPassword":"test12345"}


### 4. 비밀번호 초기화를 위한 사용자 임시 토큰 발급 (다른 클라이언트로 다른 스코프를 요청해야함)

### email로 사용자 조회

GET http://localhost:8089/admin/realms/polio/users?email=tutuatutu1@gmail.com
Authorization: Bearer {{client_access_token}}


### 사용자 impersonation/ token 요청
### 사용자를 가장하여 token 발급 (scope 포함)
POST http://localhost:8089/realms/polio/protocol/openid-connect/token
Content-Type: application/x-www-form-urlencoded

    client_id=polio-toy-client
    &client_secret=I6uiQiYIegQVvvIsAgFUpexpgNjfR86H
    &grant_type=urn:ietf:params:oauth:grant-type:token-exchange
    &subject_token={{client_access_token}}
    &requested_subject=9d833fc5-cc1e-4b60-8f5e-27fdb3c3db70
    &audience=polio-toy-client-action
    &scope=password-reset




### Access token을 포함한 보호된 API 요청
GET http://localhost:8080/auth/me
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJVR3pubEo0NlNmLUhOTno0M1NYcHNPOTQ1aFQ3amxBSEdTTDhuRnVmamEwIn0.eyJleHAiOjE3NTEyODMzODUsImlhdCI6MTc1MTE5Njk4NSwianRpIjoiMWFlOTFlN2MtMGM3Yy00ZTlkLWJlYWItMDU1OWNmNThjZDBkIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDg5L3JlYWxtcy9wb2xpbyIsImF1ZCI6WyJhY2NvdW50IiwicG9saW8tdG95LWNsaWVudC1hY3Rpb24iXSwic3ViIjoiOWQ4MzNmYzUtY2MxZS00YjYwLThmNWUtMjdmZGIzYzNkYjcwIiwidHlwIjoiQmVhcmVyIiwiYXpwIjoicG9saW8tdG95LWNsaWVudCIsInNlc3Npb25fc3RhdGUiOiIxYjFjM2JhOS1kZGQ4LTQ4ZWQtYjdiNC1lMzhlYTRkODExMDgiLCJhY3IiOiIxIiwiYWxsb3dlZC1vcmlnaW5zIjpbIi8qIl0sInJlYWxtX2FjY2VzcyI6eyJyb2xlcyI6WyJhdXRoZW50aWNhdGVkIiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiIsImRlZmF1bHQtcm9sZXMtcG9saW8iXX0sInJlc291cmNlX2FjY2VzcyI6eyJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50IiwibWFuYWdlLWFjY291bnQtbGlua3MiLCJ2aWV3LXByb2ZpbGUiXX19LCJzY29wZSI6Im9mZmxpbmVfYWNjZXNzIGVtYWlsIHByb2ZpbGUiLCJzaWQiOiIxYjFjM2JhOS1kZGQ4LTQ4ZWQtYjdiNC1lMzhlYTRkODExMDgiLCJlbWFpbF92ZXJpZmllZCI6ZmFsc2UsInByZWZlcnJlZF91c2VybmFtZSI6InRlc3QiLCJlbWFpbCI6InR1dHVhdHV0dTFAZ21haWwuY29tIn0.bsVsEkqucX_WrQWavAX6eIqupcjsOwZzsjH04goGHtAdm0nbI2CralhKZMN-QBxPd6UXWARTKavd3p5r6UXf99QNYI-v2gQM0EooAVn6Ir3RCU-LfdYgW-Odn5qhes0E-m_vMI3ZcVXMuuNB0FrHhjsz_YlHQd0H2TDnRkpwI_7F2ZgSqZNyVX0yEdSdt_HQV3OAFB5s5mjU4byvBVtZRumBmrZGd9DilhEUS_ZGeIyW6USsOjLrj2cAD0I7YMwOwjGnhmZL8IDCwrN6-6_hvNAbQyQ5G-5EQ1ynK2tPmyYpWSxON4A7Aee2jJkcWXDOdebE9Z1PhahBisna_1zPuA